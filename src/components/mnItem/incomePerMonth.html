<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="author" content="FrankLee"/>
    <meta name="description" content="GoMobile - A next generation web app theme"/>
    <meta name="keywords"
          content="mobile web app, mobile template, mobile design, mobile app design, mobile app theme, mobile wordpress theme, my mobile app"/>

    <title>记账</title>
    <link type="text/css" rel="stylesheet" href="/static/public/css/style.css">
    <link type="text/css" rel="stylesheet" href="/static/public/colors/green/green.css">
    <link type="text/css" rel="stylesheet" href="/static/public/css/idangerous.swiper.css">
    <link type="text/css" rel="stylesheet" href="/static/public/css/swipebox.css"/>
    <script type="text/javascript" src="/static/public/js/jquery-1.10.1.min.js"></script>
    <script src="/static/public/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="/static/public/js/mn.js" type="text/javascript"></script>

    <link rel="stylesheet" href="/static/public/plugins/jquery-ui/1.11.4/jquery-ui.css">
    <script type="text/javascript" src="/static/public/plugins/jquery-ui/1.11.4/jquery-ui.js"></script>

    <script type="text/javascript">

        (function($) {
            $.fn.monthpicker = function(options) {
                var defaults = {
                    Year: new Date().getFullYear(), //显示年
                    SelectMonth: null, //选择日期
                    SelectYear: null,
                    format:"yyyy-MM"
                }
                var options = $.extend(defaults, options);

                PreYear = function(m) {
                    options.Year = options.Year - 1;
                    Draw(m);
                }
                NextYear = function(m) {
                    options.Year = options.Year + 1;
                    Draw(m);
                }
                IsSame = function(d1, d2) {
                    return (d1.getFullYear() == d2.getFullYear() && d1.getMonth() == d2.getMonth());
                }
                Date.prototype.Format = function(fmt)
                { //author: meizz
                    var o = {
                        "M+" : this.getMonth()+1,                 //月份
                        "d+" : this.getDate(),                    //日
                        "h+" : this.getHours(),                   //小时
                        "m+" : this.getMinutes(),                 //分
                        "s+" : this.getSeconds(),                 //秒
                        "q+" : Math.floor((this.getMonth()+3)/3), //季度
                        "S"  : this.getMilliseconds()             //毫秒
                    };
                    if(/(y+)/.test(fmt))
                        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
                    for(var k in o)
                        if(new RegExp("("+ k +")").test(fmt))
                            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
                    return fmt;
                }
                Draw = function(m) {
                    $("#ui-datepicker-div").remove();
                    var datepicker_div = $('<div id="ui-datepicker-div" style="z-index: 999999" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>');
                    var header = $('<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-all"></div>');
                    var pre = $('<a title="&lt;上年" class="ui-datepicker-prev ui-corner-all"><span class="ui-icon ui-icon-circle-triangle-w">&lt;上年</span></a>');
                    var next = $('<a title="下年&gt;" class="ui-datepicker-next ui-corner-all"><span class="ui-icon ui-icon-circle-triangle-e">下年&gt;</span></a>')
                    var year = '<div class="ui-datepicker-title"><span class="ui-datepicker-year">' + options.Year + '</span>年&nbsp;</div>';
                    header.append(pre).append(next).append(year);
                    pre.click(function() {
                        PreYear(m);
                    });
                    next.click(function() {
                        NextYear(m);
                    });
                    var sarr = ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"];
                    var iarr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
                    var table = $('<table class="ui-datepicker-calendar"></table>');
                    while (sarr.length) {
                        var row = $("<tr></tr>");
                        for (var i = 1; i <= 3; i++) {
                            if (sarr.length) {
                                var cell = $("<td></td>");
                                var a = $('<a class="ui-state-default"></a>');
                                var d = sarr.shift();
                                var ia = iarr.shift();
                                if (d) {
                                    a.html(d);
                                    a.attr("title", ia);
                                    var on = new Date(options.Year, ia - 1, 1);
                                    //判断是否今月
                                    IsSame(on, new Date()) && a.addClass("ui-state-highlight");
                                    //判断是否选择日期
                                    options.SelectYear && options.SelectMonth && IsSame(on, new Date(options.SelectYear, options.SelectMonth - 1, 1)) && a.addClass("ui-state-active");
                                }
                                a.click(function() {
                                    var month = $(this).attr("title");
                                    options.SelectMonth = parseInt(month);
                                    options.SelectYear = options.Year;
                                    m.val(new Date(options.Year,options.SelectMonth-1,1).Format(options.format));
                                    datepicker_div.remove();
//                                    console.info("选择的月份是：" + m.val());
                                    window.location.href = "/mnItem/incomePerMonth?month=" + m.val();
                                });
                                cell.append(a);
                                row.append(cell);
                            }
                        }
                        table.append(row);
                    }
                    var of = m.offset();
                    var left = of.left;
                    var top = of.top + m.outerHeight() + 2;
                    datepicker_div.append(header).append(table);
                    datepicker_div.show();
                    datepicker_div.css("top", top);
                    datepicker_div.css("left", left);
                    datepicker_div.css("position", "absolute");
                    $("body").append(datepicker_div);
                }

                this.each(function() {
                    var $This=$(this);
                    $This.addClass("jg-monthpicker");
                    $(this).focus(function() {
                        Draw($This);
                        $("#ui-datepicker-div").show();
                    });
                    $(document).click(function (e) {
                        if (!e.target.className &&( e.target.className.toString().indexOf('jg-monthpicker') < 0||e.target.className.toString().indexOf('ui-datepicker-div') < 0||
                                e.target.className.toString().indexOf('ui-datepicker-prev') < 0||e.target.className.toString().indexOf('ui-datepicker-next') < 0)) {
                            $("#ui-datepicker-div").remove();
                        }
                    });
                });
            };
        })(jQuery);

        $(function () {
            $('#header').animate({'top': '0px'}, 400);
            $("#monthPicker").monthpicker();
            $("#monthPickerImg").monthpicker();
        });
    </script>
</head>
<body>
{% include "mn/head.html" %}

<div class="swiper-container swiper-parent">
    <div class="swiper-wrapper">

        <div class="swiper-slide sliderbg">
            <div class="swiper-container swiper-nested">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="slide-inner">
                            <div class="pages_container">
                                <div class="posts_archive_page">

                                    <h2 class="page_title">本月收入汇总</h2>
                                    <div class="toogle_wrap_blog radius8">
                                        <div>
                                            <span style="border: none; background-color: #85af5d;color: #fff;font-size: 30px;line-height: 35px;">请选择月份：</span>
                                            <input id="monthPicker" class="jg-monthpicker"  value="{{month}}" readonly="readonly"  type="text" style=" width: 120px;border: none; background-color: #85af5d;color: #fff;font-size: 30px;line-height: 35px;" >
                                        </div>
                                    </div>

                                    <ul class="posts">
                                        {% if currentMonthSumMap and currentMonthSumMap|length > 0 %}
                                            <li class="post" id="postid1" >
                                                <a href="javascript:void(0)" class="post_more"></a>
                                                <div class="post_right_reveal">
                                                    <h4>
                                                        <span>收入：
                                                            <span style="color:green" >
                                                                {{currentMonthSumMap.income}}
                                                            </span>
                                                        </span>
                                                    </h4>
                                                    <h4>
                                                        <span>支出：
                                                            <span style="color:red" >
                                                                {{currentMonthSumMap.pay}}
                                                            </span>
                                                        </span>
                                                    </h4>
                                                    <h4>
                                                        <span>结余：
                                                            <span style="color:black" >
                                                                {{currentMonthSumMap.left}}
                                                            </span>
                                                        </span>
                                                    </h4>
                                                </div>
                                                <div class="post_left">
                                                    <div class="container_white">
                                                        <span>总计</span>
                                                    </div>
                                                </div>
                                            </li>
                                         {%endif%}


                                        {% if mnItemList and mnItemList|length > 0%}
                                            {% for mn in mnItemList %}

                                                    <li class="post" id="postid1">
                                                        <a href="/mnItem/dayList?day={{mn.note_date}}" class="post_more"></a>

                                                        <div class="post_right_reveal">
                                                            <h4><span style="color:green">总收入 : &yen; {{mn.money}}</span></h4>
                                                        </div>
                                                        <div class="post_left">
                                                            <span class="day">{{mn.day}}</span>
                                                            <span class="month">{{mn.month}}月</span>
                                                        </div>
                                                    </li>
                                            {%endfor%}
                                        {%else%}
                                                <div style="text-align: center">
                                                    没有相关数据!
                                                </div>
                                        {%endif%}


                                    </ul>


                                </div>
                                <!--End of posts archive page-->

                                <div class="scrolltop radius20"><a href="#"><img src="/static/public/images/icons/top.png"
                                                                                 alt="Go on top" title="Go on top"/></a>
                                </div>
                            </div>
                            <!--End of page container-->
                        </div>
                    </div>
                </div>
                <div class="swiper-scrollbar"></div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
